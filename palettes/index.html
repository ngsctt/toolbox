<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CVD palette sim</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="./palettes.css">
</head>

<body>
  <nav>
    <a href="../">← back to home</a>
  </nav>
  <main>
    <h1>Colour blindness palette simulator</h1>
    <details>
      <summary>Prevalence</summary>
      <table class="prevalence">
        <thead>
          <tr>
            <th colspan="2">Type</th>
            <th>Males</th>
            <th>Females</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th rowspan="2">Protan</th>
            <th>Protanomoly</th>
            <td>1.08%</td>
          </tr>
          <tr>
            <th>Protanopia</th>
            <td>1.01%</td>
          </tr>
          <tr>
            <th rowspan="2">Deutan</th>
            <th>Deuteranomoly</th>
            <td>4.63%</td>
          </tr>
          <tr>
            <th>Deuteranopia</th>
            <td>1.24%</td>
          </tr>
          <tr>
            <th rowspan="2">Tritan</th>
            <th>Tritanomoly</th>
          </tr>
          <tr>
            <th>Tritanopia</th>
            <td>0.002–0.008% (est.)</td>
          </tr>
          <tr>
            <th rowspan="2">Mono</th>
            <th>Blue cone monochromacy</th>
            <td>0.001% (est.)</td>
          </tr>
          <tr>
            <th>Rod monochromacy</th>
            <td>~0.002%</td>
          </tr>
        </tbody>
      </table>
      <!-- <td>Protanomoly: 1.08% males<br>Protanopia: 1.01% males</td>
        <td>Deuteranomoly: 4.63% males<br>Deuteranopia: 1.24% males</td>
        <td>Tritanopia: est. 0.002–0.008% males</td>
        <td>Blue cone monochromacy: est. 0.001% males<br>Rod monochromacy: ~0.002%</td> -->
    </details>

    <label class="anomaly-label">
      <span class="span">-anomaly</span>
      <span>Normal</span>
      <input type="range" name="anomoly" id="anomaly" min="0" max="1" step="0.01" value="0.66">
      <span>-anopia</span>
      <input class="span" id="anomaly-value" type="number" min="0" max="1" step="0.01" value="0.66"></span>
    </label>

    <table class="sim">
      <thead>
        <tr>
          <th>Original</th>
          <th>Protan</th>
          <th>Deutan</th>
          <th>Tritan</th>
          <th>Monochromacy</th>
        </tr>
        <tr>
          <td></td>
          <td>Viénot 1999</td>
          <td>Viénot 1999</td>
          <td>Brettel 1997</td>
          <td>CSS <code>grayscale()</code></td>
        </tr>
      </thead>
      <tbody id="palette"></tbody>
      <tfoot>
        <tr>
          <td>
            <button id="add">Add</button>
          </td>
        </tr>
      </tfoot>
    </table>
  </main>

  <template id="colour">
    <tr class="colour">
      <td class="variant primary">
        <!-- <h2>Normal</h2> -->
        <input class="well" type="color" name="colour" id="colour">
        <div class="controls">
          <div class="lch" style="display: none;">
            <label>
              L:
              <input type="range" name="L" min="0" max="1" step="0.001">
            </label>
            <label>
              C:
              <input type="range" name="C" min="0" max="0.4" step="0.001">
            </label>
            <label>
              H:
              <input type="range" name="H" min="0" max="360">
            </label>
          </div>
        </div>
      </td>
      <td class="variant protan">
        <!-- <h2>Protanopia</h2> -->
        <div class="well">
          <div class="well-inner"></div>
        </div>
      </td>
      <td class="variant deutan">
        <!-- <h2>Deuteranopia</h2> -->
        <div class="well">
          <div class="well-inner"></div>
        </div>
      </td>
      <td class="variant tritan">
        <!-- <h2>Tritanopia</h2> -->
        <div class="well">
          <div class="well-inner"></div>
        </div>
      </td>
      <td class="variant mono">
        <!-- <h2>Monochromacy</h2> -->
        <div class="well">
          <div class="well-inner"></div>
        </div>
      </td>
    </tr>
  </template>

  <script>
    const template = document.getElementById('colour');
    const palette = document.getElementById('palette');
    const anomaly = document.getElementById('anomaly');
    const anomaly_value = document.getElementById('anomaly-value');
    const add = document.getElementById('add');
    const colours = document.querySelectorAll('.colour');

    function syncWells (colour) {
      const primary = colour.querySelector('input.well');
      if (primary?.value == undefined) return;
      const wells = colour.querySelectorAll('div.well');
      wells.forEach(w => w.style = `--colour: ${primary.value}`);
    }
    function syncAnomaly (target) {
      palette.style = `--anomaly: ${target.value};`;
      if (target === anomaly) anomaly_value.value = target.value;
      else anomaly.value = target.value;
    }

    window.addEventListener('input', event => {
      if (event.target === anomaly || event.target === anomaly_value) syncAnomaly(event.target);
      else if (event.target.tagName === 'INPUT' && event.target.type === 'color' && event.target.classList.contains('well')) {
        const colour = event.target.closest('.colour');
        if (!colour) return;
        syncWells(colour);
      }
    });
    window.addEventListener('load', event => {
      syncAnomaly(anomaly);
      colours.forEach(c => syncWells(c));
    });
    add.addEventListener('click', event => {
      const newColour = template.content.cloneNode(true);
      const randomHex = Math.floor(Math.random()*16777215).toString(16);
      newColour.querySelector('input.well').value = '#' + randomHex;
      syncWells(newColour);
      palette.append(newColour);
    });
  </script>
</body>

</html>